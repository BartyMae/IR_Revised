// EE fixes
ACTION_IF (GAME_IS ~bgee bg2ee eet~ AND NOT GAME_IS ~tutu tutu_totsc bg2 tob bgt~) BEGIN

INCLUDE ~item_rev/lib/identify_fix.tpa~
INCLUDE ~item_rev/lib/identify_item.tpa~

/////////////////////////////////////
DEFINE_ACTION_MACRO ~Locations~ BEGIN
// for weapons
OUTER_SET wgrey = 16
OUTER_SET wteal = 17
OUTER_SET wpink = 18
OUTER_SET wyellow = 19
OUTER_SET wred = 20
OUTER_SET wblue = 21
OUTER_SET wgreen = 22
// for helmets
OUTER_SET hgrey = 48
OUTER_SET hteal = 49
OUTER_SET hpink = 50
OUTER_SET hyellow = 51
OUTER_SET hred = 52
OUTER_SET hblue = 53
OUTER_SET hgreen = 54
// for shields
OUTER_SET sgrey = 32
OUTER_SET steal = 33
OUTER_SET spink = 34
OUTER_SET syellow = 35
OUTER_SET sred = 36
OUTER_SET sblue = 37
OUTER_SET sgreen = 38
// for armour
OUTER_SET agrey = 0
OUTER_SET ateal = 1
OUTER_SET apink = 2
OUTER_SET ayellow = 3
OUTER_SET ared = 4
OUTER_SET ablue = 5
OUTER_SET agreen = 6
END

DEFINE_PATCH_MACRO ~clear~ BEGIN
SET opcode_to_delete = 7
LAUNCH_PATCH_MACRO DELETE_ITEM_EQEFFECT
SET opcode_to_delete = 8
LAUNCH_PATCH_MACRO DELETE_ITEM_EQEFFECT
SET opcode_to_delete = 9
LAUNCH_PATCH_MACRO DELETE_ITEM_EQEFFECT
END


DEFINE_PATCH_MACRO ~colour~ BEGIN
SET opcode = 7      // Set opcode
SET target = 1      // target type
SET timing = 2      // timing type
SET power = 0      // power
SET resist_dispel = 0  // dispel/resitance
SET duration = 0    // duration
SET probability1 = 100  // probability 1
SET probability2 = 0  // probability 2
SPRINT "resource" ""     // resource
SET dicenumber = 0    // dice number 
SET dicesize = 0    // dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0    // saving throw bonus 
SET parameter1 = gradient // set colour gradient
SET parameter2 = location // set location
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
END

DEFINE_PATCH_MACRO ~pulse~ BEGIN
SET opcode = 9    // Set opcode
SET target = 1      // target type
SET timing = 2      // timing type
SET power = 0      // power
SET resist_dispel = 0  // dispel/resitance
SET duration = 0    // duration
SET probability1 = 100  // probability 1
SET probability2 = 0  // probability 2
SPRINT "resource" ""     // resource
SET dicenumber = 0    // dice number 
SET dicesize = 0    // dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0    // saving throw bonus 
SET setrgb = (setb << 24)+(setg << 16)+(setr << 8) // Set RGB
SET parameter1 = setrgb
SET settwo = (speed << 16)+(location) // Set location and speed
SET parameter2 = settwo
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
END

DEFINE_PATCH_MACRO ~glow~ BEGIN
SET opcode = 8    // Set opcode
SET target = 1      // target type
SET timing = 2      // timing type
SET power = 0      // power
SET resist_dispel = 0  // dispel/resitance
SET duration = 0    // duration
SET probability1 = 100  // probability 1
SET probability2 = 0  // probability 2
SPRINT "resource" ""     // resource
SET dicenumber = 0    // dice number 
SET dicesize = 0    // dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0    // saving throw bonus 
SET setrgb = (setb << 24)+(setg << 16)+(setr << 8) // Set RGB
SET parameter1 = setrgb
SET parameter2 = location // set location
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
END

OUTER_SET pcolour = 1

ACTION_IF ee_helms_shields_colors = 2 BEGIN
  OUTER_SET pcolour = 2
END

ACTION_IF ee_helms_shields_colors = 3 BEGIN
  OUTER_SET pcolour = 4
END

  COPY_EXISTING_REGEXP GLOB ~^.+\.itm$~ override PATCH_IF SOURCE_SIZE>0x71 BEGIN
    LPM identify_item
    PATCH_IF short_bow BEGIN // fix short bow animations
      WRITE_ASCII 0x22 ~BS~
    END
    PATCH_IF bastard_sword BEGIN // fix bastard sword animations
      WRITE_ASCII 0x22 ~S0~
    END
  END
  
  	ACTION_FOR_EACH resource IN // fix BG1 creature bows
      ~compb05~
      ~compb06~
      ~compb08~
      ~compb18~
    BEGIN
      ACTION_IF (FILE_EXISTS_IN_GAME ~%resource%.itm~) BEGIN
        COPY_EXISTING ~%resource%.itm~ ~override\%resource%.itm~
        PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN 
          WRITE_ASCII 0x22 ~BW~
        END
      END
	END
	ACTION_FOR_EACH resource IN // fix BG1 creature swords
      ~comps01~
      ~comps02~
      ~comps03~
      ~comps42~
    BEGIN
      ACTION_IF (FILE_EXISTS_IN_GAME ~%resource%.itm~) BEGIN
        COPY_EXISTING ~%resource%.itm~ ~override\%resource%.itm~
        PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN 
          WRITE_ASCII 0x22 ~S1~
        END
      END
	END
  
  LAUNCH_ACTION_MACRO ~Locations~
  
  // Flame Sword fixes
  ACTION_FOR_EACH resource IN // fix flaming long swords
    ~miscbc~
	~rodsword~
    ~sw1h27~
    ~sw1h39~
    ~sw1h53~
  BEGIN
    ACTION_IF (FILE_EXISTS_IN_GAME ~%resource%.itm~) BEGIN
      COPY_EXISTING ~%resource%.itm~ ~override\%resource%.itm~
      PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN 
        WRITE_ASCII 0x22 ~FS~
      END
    END
  END

  ACTION_FOR_EACH resource IN // fix flaming short swords
    ~npsw06~
	~sblade~
    ~sw1h27~
  BEGIN
    ACTION_IF (FILE_EXISTS_IN_GAME ~%resource%.itm~) BEGIN
      COPY_EXISTING ~%resource%.itm~ ~override\%resource%.itm~
      PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN 
        WRITE_ASCII 0x22 ~F2~
      END
    END
  END

  // Flails of Ages fixes
   ACTION_IF (FILE_EXISTS_IN_GAME ~blun14.itm~) THEN BEGIN
COPY_EXISTING ~blun14.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x22 ~F3~
     // WRITE_LONG  0x3E 0
     // WRITE_ASCII 0x3A ~IBLUN13B~
   // WRITE_LONG  0x7A 0
     // WRITE_ASCII 0x76 ~IBLUN13B~
  LAUNCH_PATCH_MACRO ~clear~
  SET setr = 229
  SET setg = 215
  SET setb = 83
  SET speed = 0x64
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~pulse~
  SET gradient = 245  // colour index
  SET location = wgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 243  // colour index
  SET location = wpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 244  // colour index
  SET location = wred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 252  // colour index
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~colour~
    END
  BUT_ONLY_IF_IT_CHANGES
  END

  ACTION_IF (FILE_EXISTS_IN_GAME ~blun14e.itm~) THEN BEGIN
COPY_EXISTING ~blun14e.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x22 ~F1~
     // WRITE_LONG  0x3E 0
     // WRITE_ASCII 0x3A ~IBLUN13B~
   // WRITE_LONG  0x7A 0
     // WRITE_ASCII 0x76 ~IBLUN13B~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 252  // colour index
  SET location = wgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 91  // colour index
  SET location = wred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 245  // colour index
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~colour~
    END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~blun14f.itm~) THEN BEGIN
COPY_EXISTING ~blun14f.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x22 ~F1~
     // WRITE_LONG  0x3E 0
     // WRITE_ASCII 0x3A ~IBLUN13B~
   // WRITE_LONG  0x7A 0
     // WRITE_ASCII 0x76 ~IBLUN13B~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 246  // colour index
  SET location = wgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 91  // colour index
  SET location = wred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 243  // colour index
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~colour~
    END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~blun14g.itm~) THEN BEGIN
COPY_EXISTING ~blun14g.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x22 ~F0~
     // WRITE_LONG  0x3E 0
     // WRITE_ASCII 0x3A ~IBLUN13B~
   // WRITE_LONG  0x7A 0
     // WRITE_ASCII 0x76 ~IBLUN13B~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 246  // colour index
  SET location = wgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 91  // colour index
  SET location = wred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 245  // colour index
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~colour~
    END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~blun14h.itm~) THEN BEGIN
COPY_EXISTING ~blun14h.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x22 ~F0~
     // WRITE_LONG  0x3E 0
     // WRITE_ASCII 0x3A ~IBLUN13B~
   // WRITE_LONG  0x7A 0
     // WRITE_ASCII 0x76 ~IBLUN13B~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 246  // colour index
  SET location = wgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 91  // colour index
  SET location = wred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 243  // colour index
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~colour~
    END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~blun14i.itm~) THEN BEGIN
COPY_EXISTING ~blun14i.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x22 ~F0~
     // WRITE_LONG  0x3E 0
     // WRITE_ASCII 0x3A ~IBLUN13B~
   // WRITE_LONG  0x7A 0
     // WRITE_ASCII 0x76 ~IBLUN13B~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 246  // colour index
  SET location = wgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 91  // colour index
  SET location = wred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 246  // colour index
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~colour~
    END
  BUT_ONLY_IF_IT_CHANGES
  END
  
ACTION_IF (FILE_EXISTS_IN_GAME ~blun30.itm~) THEN BEGIN
COPY_EXISTING ~blun30.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x22 ~F3~
     // WRITE_LONG  0x3E 0
     // WRITE_ASCII 0x3A ~IBLUN13B~
   // WRITE_LONG  0x7A 0
     // WRITE_ASCII 0x76 ~IBLUN13B~
  LAUNCH_PATCH_MACRO ~clear~
  SET setr = 229
  SET setg = 215
  SET setb = 83
  SET speed = 0x64
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~pulse~
  SET gradient = 218  // colour index
  SET location = wgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 216  // colour index
  SET location = wpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 244  // colour index
  SET location = wred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 228  // colour index
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~colour~
    END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~blun30c.itm~) THEN BEGIN
COPY_EXISTING ~blun30c.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x22 ~F3~
     // WRITE_LONG  0x3E 0
     // WRITE_ASCII 0x3A ~IBLUN13B~
   // WRITE_LONG  0x7A 0
     // WRITE_ASCII 0x76 ~IBLUN13B~
  LAUNCH_PATCH_MACRO ~clear~
  SET setr = 229
  SET setg = 215
  SET setb = 83
  SET speed = 0x64
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~pulse~
  SET gradient = 245  // colour index
  SET location = wgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 243  // colour index
  SET location = wpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 244  // colour index
  SET location = wred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 228  // colour index
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~colour~
    END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~blun30d.itm~) THEN BEGIN
COPY_EXISTING ~blun30d.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x22 ~F3~
     // WRITE_LONG  0x3E 0
     // WRITE_ASCII 0x3A ~IBLUN13B~
   // WRITE_LONG  0x7A 0
     // WRITE_ASCII 0x76 ~IBLUN13B~
  LAUNCH_PATCH_MACRO ~clear~
  SET setr = 229
  SET setg = 215
  SET setb = 83
  SET speed = 0x64
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~pulse~
  SET gradient = 245  // colour index
  SET location = wgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 243  // colour index
  SET location = wpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 244  // colour index
  SET location = wred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 228  // colour index
  SET location = wblue    // location
  LAUNCH_PATCH_MACRO ~colour~
    END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  // Weapon fixes
  ACTION_IF (FILE_EXISTS_IN_GAME ~blun12.itm~) THEN BEGIN //
    COPY_EXISTING ~blun12.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~M2~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~blun13.itm~) THEN BEGIN //
    COPY_EXISTING ~blun13.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~F0~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~blun25.itm~) THEN BEGIN //
    COPY_EXISTING ~blun25.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~M2~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~waflail.itm~) THEN BEGIN //
    COPY_EXISTING ~waflail.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~F0~ //animation type
    END
  END
  
  // Shield Fixes
ACTION_IF (FILE_EXISTS_IN_GAME ~shld01.itm~) THEN BEGIN
COPY_EXISTING ~shld01.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C0~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDS01~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GSSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD25~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 200    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 21    // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 238    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END

ACTION_IF (FILE_EXISTS_IN_GAME ~shld02.itm~) THEN BEGIN
COPY_EXISTING ~shld02.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C0~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDS04~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GSSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD25~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 99    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 87    // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 2    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
    END
  BUT_ONLY_IF_IT_CHANGES
  END
  
ACTION_IF (FILE_EXISTS_IN_GAME ~shld03.itm~) THEN BEGIN
COPY_EXISTING ~shld03.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C1~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDM01~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GMSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLDM0~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 226    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 209    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 226  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 87    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END


  ACTION_IF (FILE_EXISTS_IN_GAME ~shld04.itm~) THEN BEGIN
COPY_EXISTING ~shld04.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C1~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDM05~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GMSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLDM0~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 208    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 210    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 211  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
    SET gradient = 66    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
   END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld05.itm~) THEN BEGIN
COPY_EXISTING ~shld05.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C2~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDL01~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GLSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD30~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 239    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 233    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 234  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 41    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld06.itm~) THEN BEGIN
COPY_EXISTING ~shld06.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C2~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDL04~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GLSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD30~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 226    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 72    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 93  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 237    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
ACTION_IF (FILE_EXISTS_IN_GAME ~shld07.itm~) THEN BEGIN
COPY_EXISTING ~shld07.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C6~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1SHLDL02~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GLSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CSHLDL2~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 249    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 66    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 249  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 51    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
ACTION_IF (FILE_EXISTS_IN_GAME ~shld08.itm~) THEN BEGIN
COPY_EXISTING ~shld08.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C4~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDB01~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GBSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CSHLDB1~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 226    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 239    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 226  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 188    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld09.itm~) THEN BEGIN
COPY_EXISTING ~shld09.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C4~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDB02~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GBSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CSHLDB1~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 192    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 186    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 192  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 184    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld10.itm~) THEN BEGIN
COPY_EXISTING ~shld10.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C4~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDB03~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GBSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CSHLDB1~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 226    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 160    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 226  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 206    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld11.itm~) THEN BEGIN
COPY_EXISTING ~shld11.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C0~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDS02~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GSSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD25~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 227    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 232    // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 183    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld12.itm~) THEN BEGIN
COPY_EXISTING ~shld12.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C0~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDS03~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GSSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD25~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 24    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 209    // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 87    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
 ACTION_IF (FILE_EXISTS_IN_GAME ~shld13.itm~) THEN BEGIN
COPY_EXISTING ~shld13.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C1~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDM02~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GMSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLDM0~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 217    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 231    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 202  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 186    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld14.itm~) THEN BEGIN
COPY_EXISTING ~shld14.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C1~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDM03~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GMSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLDM0~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 226    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 237    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 209  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 238    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
   ACTION_IF (FILE_EXISTS_IN_GAME ~shld15.itm~) THEN BEGIN
COPY_EXISTING ~shld15.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C2~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDL02~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GLSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD30~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 202    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 235    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 235  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 204    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
   ACTION_IF (FILE_EXISTS_IN_GAME ~shld16.itm~) THEN BEGIN
COPY_EXISTING ~shld16.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C2~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDL03~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GLSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD30~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 239    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 208    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 234  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 238    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld17.itm~) THEN BEGIN
COPY_EXISTING ~shld17.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C4~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDB04~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GBSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CSHLDB1~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 250    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 187    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 224  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 187    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld19.itm~) THEN BEGIN
COPY_EXISTING ~shld19.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C2~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDL06~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GLSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD30~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 208    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 209    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 225  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 183    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld08.itm~) THEN BEGIN
COPY_EXISTING ~shld08.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C4~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDB01~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GBSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CSHLDB1~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 226    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 239    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 226  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 188    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld20.itm~) THEN BEGIN
COPY_EXISTING ~shld20.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
LAUNCH_PATCH_MACRO ~clear~
SET gradient = 94    // colour index
SET location = sred    // location
LAUNCH_PATCH_MACRO ~colour~
SET gradient = 92    // colour index
SET location = sblue    // location
LAUNCH_PATCH_MACRO ~colour~
SET gradient = 95    // colour index
SET location = sgrey    // location
LAUNCH_PATCH_MACRO ~colour~
PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 94    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
END
  BUT_ONLY_IF_IT_CHANGES
END
  

  ACTION_IF (FILE_EXISTS_IN_GAME ~shld21.itm~) THEN BEGIN
COPY_EXISTING ~shld21.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C7~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLD21~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GMSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD21~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 26    // colour index 216
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 101    // colour index 214
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 215  // colour index 215
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 210    // colour index 210
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld22.itm~) THEN BEGIN
COPY_EXISTING ~shld22.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C3~
    LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 203    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 201    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 30  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 182    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
 
 ACTION_IF (FILE_EXISTS_IN_GAME ~chalshld.itm~) THEN BEGIN
COPY_EXISTING ~chalshld.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C3~
    LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 203    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 201    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 30  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 182    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END

 ACTION_IF (FILE_EXISTS_IN_GAME ~npshld.itm~) THEN BEGIN
COPY_EXISTING ~npshld.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C3~
      WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GMSHLD~
    LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 218    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 192    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 217  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 60    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
 
    ACTION_IF (FILE_EXISTS_IN_GAME ~shld23.itm~) THEN BEGIN
COPY_EXISTING ~shld23.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C2~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLD23~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GLSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD23~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 217    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 96    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 184  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 190    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld24.itm~) THEN BEGIN
COPY_EXISTING ~shld24.itm~ ~override~ //Fix tower shield animation (note: having to use its original small shield animation here for the time being, because there isn't really a suitable buckler icon for it - still erroneous, but nearly as bad as the tower shield!)
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C0~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLD24~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GSSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD24~
  LAUNCH_PATCH_MACRO ~clear~
	SET gradient = 43		// colour index
	SET location = sred		// location
	LAUNCH_PATCH_MACRO ~colour~
	SET gradient = 95		// colour index
	SET location = sblue		// location
	LAUNCH_PATCH_MACRO ~colour~
	SET gradient = 42		// colour index
	SET location = sgrey		// location
	LAUNCH_PATCH_MACRO ~colour~
	SET gradient = 43		// colour index
	SET location = spink		// location
  LAUNCH_PATCH_MACRO ~colour~
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld25.itm~) THEN BEGIN
COPY_EXISTING ~shld25.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLD25~
  WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD17~
    LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 231    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 221    // colour index
  SET location = sred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 203  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 7    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld26.itm~) THEN BEGIN
COPY_EXISTING ~shld26.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C5~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1SHLDM02~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GSSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CSHLDM2~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 217    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 183    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 183  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 63    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
    END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld27.itm~) THEN BEGIN
COPY_EXISTING ~shld27.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN 
WRITE_LONG  0x3E 0
WRITE_ASCII 0x3A ~ISHLDGN~
WRITE_LONG  0x48 0
WRITE_ASCII 0x44 ~GSHLD03~
WRITE_LONG  0x5C 0
WRITE_ASCII 0x58 ~CSHLD04~
LAUNCH_PATCH_MACRO ~clear~
SET gradient = 218    // colour index
SET location = sred    // location
LAUNCH_PATCH_MACRO ~colour~
SET gradient = 217    // colour index
SET location = sblue    // location
LAUNCH_PATCH_MACRO ~colour~
SET gradient = 218    // colour index
SET location = sgrey    // location
LAUNCH_PATCH_MACRO ~colour~
PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 58    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
    END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld28.itm~) THEN BEGIN
COPY_EXISTING ~shld28.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C0~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDS05~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GSSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD28~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 212    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 254    // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 244    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld29.itm~) THEN BEGIN
COPY_EXISTING ~shld29.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C3~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDM09~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GMSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD29~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 101    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 127    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 253    // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 254    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld30.itm~) THEN BEGIN
COPY_EXISTING ~shld30.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C2~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~ISHLDL05~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GLSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CSHLD30~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 109    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 216    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 211  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 2    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld31.itm~) THEN BEGIN
COPY_EXISTING ~shld31.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C6~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1SHLDL03~
    WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GLSHLD~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CSHLDL3~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 192    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 190    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 192  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 59    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~shld32.itm~) THEN BEGIN
COPY_EXISTING ~shld32.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C3~
     LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 209    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 93    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 209  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 127    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~wa2shiel.itm~) THEN BEGIN
COPY_EXISTING ~wa2shiel.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~C3~
  WRITE_LONG  0x48 0
    WRITE_ASCII 0x44 ~GMSHLD~
     LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 226    // colour index
  SET location = sgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 113    // colour index
  SET location = steal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 113  // colour index
  SET location = sblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 1 || %pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 11    // colour index
  SET location = spink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  // Helm fixes
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm01.itm~) THEN BEGIN
COPY_EXISTING ~helm01.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J6~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM01~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CHELM01~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 14    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 28    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 202  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 202  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 202    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm02.itm~) THEN BEGIN
COPY_EXISTING ~helm02.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J3~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM26~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CHELM04~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 14    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 21    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 21  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 90  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 21    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm03.itm~) THEN BEGIN
COPY_EXISTING ~helm03.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J8~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM07~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELMX6~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 207    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 21    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 184  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 21  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 223    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm04.itm~) THEN BEGIN
COPY_EXISTING ~helm04.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J1~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM21~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELM21~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 21    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 6    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 142  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 0    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm05.itm~) THEN BEGIN
COPY_EXISTING ~helm05.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~JA~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM19~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELM18~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 0    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 210    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 27  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 224  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 159    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm06.itm~) THEN BEGIN
COPY_EXISTING ~helm06.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~JA~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM18~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELM18~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 0    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 119    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 27  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 224  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 118    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm07.itm~) THEN BEGIN
COPY_EXISTING ~helm07.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J7~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CHELM07~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 98    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 114    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 241  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 241    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm08.itm~) THEN BEGIN
COPY_EXISTING ~helm08.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J8~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM05~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELMX4~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 209    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 232  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 223    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm09.itm~) THEN BEGIN
COPY_EXISTING ~helm09.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J9~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM17~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELM17~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 223    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 27    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 27  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 224  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 195    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm10.itm~) THEN BEGIN
COPY_EXISTING ~helm10.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~JA~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM20~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELM20~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 0    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 27  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 99  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 195    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 210    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm11.itm~) THEN BEGIN
COPY_EXISTING ~helm11.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J6~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM08~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELM01~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 226    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 102  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 102  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 98    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 102    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm12.itm~) THEN BEGIN
COPY_EXISTING ~helm12.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~JC~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM02~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELMX2~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 195    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 21  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 242  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 0    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 109    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm13.itm~) THEN BEGIN
COPY_EXISTING ~helm13.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J4~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM10~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CHELM05~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 248    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 102  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 210  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 195    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm14.itm~) THEN BEGIN
COPY_EXISTING ~helm14.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J7~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM22~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CHELM07~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 209    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 182  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 21    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 225    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm15.itm~) THEN BEGIN
COPY_EXISTING ~helm15.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J3~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM23~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CHELM04~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 232    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 202  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 209  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 0    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 232    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm16.itm~) THEN BEGIN
COPY_EXISTING ~helm16.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J4~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM16~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CHELM16~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 209    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 205  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 226  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 195    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm17.itm~) THEN BEGIN
COPY_EXISTING ~helm17.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J3~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 98    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 3  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 253  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 0    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm21.itm~) THEN BEGIN
COPY_EXISTING ~helm21.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J2~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 227    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient =88  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 70  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 195    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 195    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm22.itm~) THEN BEGIN
COPY_EXISTING ~helm22.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~JC~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM03~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELMX3~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 119    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 205  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 209  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 102    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 0    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm31.itm~) THEN BEGIN
COPY_EXISTING ~helm31.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J2~
  WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELM03~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 66    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient =183  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 183  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 0    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm32.itm~) THEN BEGIN
COPY_EXISTING ~helm32.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J2~
  WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~1CHELM03~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 207    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient =199  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 199  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 0    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm33.itm~) THEN BEGIN
COPY_EXISTING ~helm33.itm~ ~override~ //Gold Horned Helm bug fix
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J3~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 223    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient =208  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 208  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  PATCH_IF (%pcolour% = 2 || %pcolour% = 3) THEN BEGIN
  SET gradient = 0    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  
 ACTION_IF (FILE_EXISTS_IN_GAME ~compon05.itm~) THEN BEGIN
COPY_EXISTING ~compon05.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J3~ //J9 is for the IWD-style icon
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 225    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient =250  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 47  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 210    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 250    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END
  

  ACTION_IF (FILE_EXISTS_IN_GAME ~wa2helm.itm~) THEN BEGIN
COPY_EXISTING ~wa2helm.itm~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    WRITE_ASCII 0x22 ~J3~
    WRITE_LONG  0x3E 0
    WRITE_ASCII 0x3A ~1HELM24~
    WRITE_LONG  0x5C 0
    WRITE_ASCII 0x58 ~CHELM04~
  LAUNCH_PATCH_MACRO ~clear~
  SET gradient = 223    // colour index
  SET location = hgrey    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 27  // colour index
  SET location = hblue    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 27  // colour index
  SET location = hred    // location
  LAUNCH_PATCH_MACRO ~colour~
  SET gradient = 0    // colour index
  SET location = hteal    // location
  LAUNCH_PATCH_MACRO ~colour~
  // PATCH_IF (%pcolour% = 2) THEN BEGIN
  SET gradient = 0    // colour index
  SET location = hpink    // location
  LAUNCH_PATCH_MACRO ~colour~
  // END
  END
  BUT_ONLY_IF_IT_CHANGES
  END

  //Projectiles fixes

  ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1arow01.PRO~

ACTION_IF (FILE_EXISTS_IN_GAME ~AROW01.ITM~) THEN BEGIN
  COPY_EXISTING ~AROW01.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROWHVY") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow01%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1arow02.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AROW02.ITM~) THEN BEGIN
  COPY_EXISTING ~AROW02.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROWHVY") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow02%~
          END
      PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROW") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow02%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
     ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1arow03.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AROW03.ITM~) THEN BEGIN
  COPY_EXISTING ~AROW03.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROW") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow03%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1arow04.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AROW04.ITM~) THEN BEGIN
  COPY_EXISTING ~AROW04.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROW") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow04%~
          END
      PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROWFLG") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow04%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1arow05.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AROW05.ITM~) THEN BEGIN
  COPY_EXISTING ~AROW05.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROW") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow05%~
          END
      PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROWHVY") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow05%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1arow07.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AROW07.ITM~) THEN BEGIN
  COPY_EXISTING ~AROW07.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROW") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow07%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1arow10.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AROW10.ITM~) THEN BEGIN
  COPY_EXISTING ~AROW10.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROW") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow10%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1arow11.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AROW11.ITM~) THEN BEGIN
  COPY_EXISTING ~AROW11.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROW") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow11%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1arow15.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AROW15.ITM~) THEN BEGIN
  COPY_EXISTING ~AROW15.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "ARROW") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1arow15%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1axe05.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H05.ITM~) THEN BEGIN
  COPY_EXISTING ~AX1H05.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe05%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H05B.ITM~) THEN BEGIN //IR fix
  COPY_EXISTING ~AX1H05B.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe05%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H06.ITM~) THEN BEGIN
  COPY_EXISTING ~AX1H06.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe05%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H06B.ITM~) THEN BEGIN //IR fix
  COPY_EXISTING ~AX1H06B.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe05%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1axe08.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H08.ITM~) THEN BEGIN
  COPY_EXISTING ~AX1H08.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe08%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
  ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H08B.ITM~) THEN BEGIN //IR fix
  COPY_EXISTING ~AX1H08B.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe08%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1axe09.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H09.ITM~) THEN BEGIN
  COPY_EXISTING ~AX1H09.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe09%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
  ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H09B.ITM~) THEN BEGIN //IR fix
  COPY_EXISTING ~AX1H09B.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe09%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
  
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1axe10.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H10.ITM~) THEN BEGIN
  COPY_EXISTING ~AX1H10.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe10%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
  ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H10B.ITM~) THEN BEGIN //IR fix
  COPY_EXISTING ~AX1H10B.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe10%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1axe16.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H16.ITM~) THEN BEGIN
  COPY_EXISTING ~AX1H16.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe16%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
  ACTION_IF (FILE_EXISTS_IN_GAME ~AX1H16B.ITM~) THEN BEGIN //IR fix
  COPY_EXISTING ~AX1H16B.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "AXE") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1axe16%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bolt01.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BOLT01.ITM~) THEN BEGIN
  COPY_EXISTING ~BOLT01.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BOLT") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bolt01%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 27  // colour index
    SET location = wpink    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bolt02.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BOLT02.ITM~) THEN BEGIN
  COPY_EXISTING ~BOLT02.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BOLT") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bolt02%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 90  // colour index
    SET location = wpink    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bolt03.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BOLT03.ITM~) THEN BEGIN
  COPY_EXISTING ~BOLT03.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BOLT") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bolt03%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 218  // colour index
    SET location = wpink    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bolt04.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BOLT04.ITM~) THEN BEGIN
  COPY_EXISTING ~BOLT04.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BOLT") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bolt04%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 252  // colour index
    SET location = wpink    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bolt05.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BOLT05.ITM~) THEN BEGIN
  COPY_EXISTING ~BOLT05.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BOLT") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bolt05%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 86  // colour index
    SET location = wpink    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bolt06.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BOLT06.ITM~) THEN BEGIN
  COPY_EXISTING ~BOLT06.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BOLT") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bolt06%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 81  // colour index
    SET location = wpink    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ACTION_IF (FILE_EXISTS_IN_GAME ~BOLT08.ITM~) THEN BEGIN
  COPY_EXISTING ~BOLT08.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 208  // colour index
    SET location = wpink    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bolt09.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BOLT09.ITM~) THEN BEGIN
  COPY_EXISTING ~BOLT09.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BOLT") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bolt09%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 227  // colour index
    SET location = wpink    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ACTION_IF (FILE_EXISTS_IN_GAME ~BULL01.ITM~) THEN BEGIN
  COPY_EXISTING ~BULL01.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 27  // colour index
    SET location = wgrey    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bull02.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BULL02.ITM~) THEN BEGIN
  COPY_EXISTING ~BULL02.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BULLET") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bull02%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 218  // colour index
    SET location = wgrey    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bull03.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BULL03.ITM~) THEN BEGIN
  COPY_EXISTING ~BULL03.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BULLET") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bull03%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 70  // colour index
    SET location = wgrey    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bull04.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BULL04.ITM~) THEN BEGIN
  COPY_EXISTING ~BULL04.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BULLET") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bull04%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 115  // colour index
    SET location = wgrey    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bull05.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BULL05.ITM~) THEN BEGIN
  COPY_EXISTING ~BULL05.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BULLET") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bull05%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 148  // colour index
    SET location = wgrey    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1bull06.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~BULL06.ITM~) THEN BEGIN
  COPY_EXISTING ~BULL06.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "BULLET") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1bull06%~
          END
        END
      END
    LAUNCH_PATCH_MACRO ~clear~
    SET gradient = 19  // colour index
    SET location = wgrey    // location
    LAUNCH_PATCH_MACRO ~colour~
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1dagg05.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~DAGG05.ITM~) THEN BEGIN
  COPY_EXISTING ~DAGG05.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DAGGER") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dagg05%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
  ACTION_IF (FILE_EXISTS_IN_GAME ~DAGG05B.ITM~) THEN BEGIN //IR fix
  COPY_EXISTING ~DAGG05B.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DAGGER") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dagg05%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1dagg11.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~DAGG11.ITM~) THEN BEGIN
  COPY_EXISTING ~DAGG11.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DAGGER") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dagg11%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
  ACTION_IF (FILE_EXISTS_IN_GAME ~DAGG11B.ITM~) THEN BEGIN //IR fix
  COPY_EXISTING ~DAGG11.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DAGGER") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dagg11%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1dagg12.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~DAGG12.ITM~) THEN BEGIN
  COPY_EXISTING ~DAGG12.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DAGGER") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dagg12%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
  ACTION_IF (FILE_EXISTS_IN_GAME ~DAGG12B.ITM~) THEN BEGIN //IR fix
  COPY_EXISTING ~DAGG12B.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DAGGER") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dagg12%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1dagg16.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~DAGG16.ITM~) THEN BEGIN
  COPY_EXISTING ~DAGG16.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DAGGER") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dagg16%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~DAGG16B.ITM~) THEN BEGIN //IR fix
  COPY_EXISTING ~DAGG16B.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DAGGER") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dagg16%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1dart01.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~DART01.ITM~) THEN BEGIN
  COPY_EXISTING ~DART01.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DART") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dart01%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1dart02.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~DART02.ITM~) THEN BEGIN
  COPY_EXISTING ~DART02.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DART") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dart02%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1dart03.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~DART03.ITM~) THEN BEGIN
  COPY_EXISTING ~DART03.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DART") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dart03%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1dart04.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~DART04.ITM~) THEN BEGIN
  COPY_EXISTING ~DART04.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DART") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dart04%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
    
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1dart05.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~DART05.ITM~) THEN BEGIN
  COPY_EXISTING ~DART05.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DART") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dart05%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END
  
    ADD_PROJECTILE      ~1pp/additions/projectiles_1pp/1dart08.PRO~
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~DART08.ITM~) THEN BEGIN
  COPY_EXISTING ~DART08.ITM~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DART") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dart08%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END

  ACTION_IF (FILE_EXISTS_IN_GAME ~ohdart50.itm~) THEN BEGIN
  COPY_EXISTING ~ohdart50.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DART") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dart02%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END

  ACTION_IF (FILE_EXISTS_IN_GAME ~ohdart51.itm~) THEN BEGIN
  COPY_EXISTING ~ohdart51.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      READ_LONG  0x64 "abil_off" ELSE 0
      READ_SHORT 0x68 "abil_num" ELSE 0
      PATCH_IF (abil_off > 0x71) BEGIN
        FOR (index = 0; index < abil_num; index = index + 1) BEGIN
          READ_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) "proj"
          LOOKUP_IDS_SYMBOL_OF_INT projectile projectl %proj% - 1
          PATCH_IF ("%projectile%" STRING_EQUAL_CASE "DART") BEGIN
            WRITE_SHORT ("%abil_off%" + 0x2a + (0x38 * "%index%")) ~%1dart02%~
          END
        END
      END
      END
    BUT_ONLY_IF_IT_CHANGES
  END

  // Staff fixes
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf01.itm~) THEN BEGIN //
    COPY_EXISTING ~staf01.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~QS~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf02.itm~) THEN BEGIN //
    COPY_EXISTING ~staf02.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q2~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf03.itm~) THEN BEGIN //
    COPY_EXISTING ~staf03.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~QS~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf04.itm~) THEN BEGIN //
    COPY_EXISTING ~staf04.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~QS~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf05.itm~) THEN BEGIN //
    COPY_EXISTING ~staf05.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q2~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf08.itm~) THEN BEGIN //
    COPY_EXISTING ~staf08.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q2~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf09.itm~) THEN BEGIN //
    COPY_EXISTING ~staf09.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q4~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf10.itm~) THEN BEGIN //
    COPY_EXISTING ~staf10.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q4~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf11.itm~) THEN BEGIN //
    COPY_EXISTING ~staf11.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~GS~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf12.itm~) THEN BEGIN //
    COPY_EXISTING ~staf12.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q2~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf13.itm~) THEN BEGIN //
    COPY_EXISTING ~staf13.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q4~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf14.itm~) THEN BEGIN //
    COPY_EXISTING ~staf14.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q3~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf15.itm~) THEN BEGIN //
    COPY_EXISTING ~staf15.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q4~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf16.itm~) THEN BEGIN //
    COPY_EXISTING ~staf16.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~QS~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf17.itm~) THEN BEGIN //
    COPY_EXISTING ~staf17.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q4~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf18.itm~) THEN BEGIN //
    COPY_EXISTING ~staf18.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q3~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf19.itm~) THEN BEGIN //
    COPY_EXISTING ~staf19.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q3~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf20.itm~) THEN BEGIN //
    COPY_EXISTING ~staf20.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q3~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf21.itm~) THEN BEGIN //
    COPY_EXISTING ~staf21.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~GS~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf22.itm~) THEN BEGIN //
    COPY_EXISTING ~staf22.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~GS~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf23.itm~) THEN BEGIN //
    COPY_EXISTING ~staf23.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~Q3~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~wastaff.itm~) THEN BEGIN //
    COPY_EXISTING ~wastaff.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~QS~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~npstaf.itm~) THEN BEGIN //
    COPY_EXISTING ~npstaf.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~QS~ //animation type
    END
  END
  
  //Drowcraft fixes
  ACTION_IF (FILE_EXISTS_IN_GAME ~dwblun01.itm~) THEN BEGIN //
    COPY_EXISTING ~dwblun01.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~F0~ //animation type
    END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~dwshld01.itm~) THEN BEGIN //
    COPY_EXISTING ~dwshld01.itm~ ~override~
    PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
      WRITE_ASCII 0x22 ~C7~ //animation type
    END
  END

// EE projectile fixes

ACTION_FOR_EACH resource IN
  ~brac18~   // Gloves of Missile Snaring
  ~shld24~   // Reflection Shield
BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~%resource%.itm~) BEGIN
    COPY_EXISTING ~%resource%.itm~ ~override\%resource%.itm~
	PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = 55 // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow01% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow02% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow03% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow04% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT  
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow05% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow07% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow10% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow11% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow15% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1axe05% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1axe08% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1axe09% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1axe10% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1axe16% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt01% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt02% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt03% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt04% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt05% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt06% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt09% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bull02% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bull03% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bull04% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bull05% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bull06% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dagg05% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dagg11% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dagg12% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dagg16% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart01% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart02% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart03% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart04% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart05% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 2			// timing type
SET power = 0			// power
SET resist_dispel = 0	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart08% - 1) // param2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
	END	BUT_ONLY_IF_IT_CHANGES
  END
END

ACTION_IF (FILE_EXISTS_IN_GAME ~dvsrv3.mrk~) THEN BEGIN // SR check
ACTION_IF (FILE_EXISTS_IN_GAME ~npshld.spl~) THEN BEGIN // Delryn Family Shield
COPY_EXISTING ~npshld.spl~ ~override~
PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = 55 // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow01% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow02% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow03% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow04% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
  
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow05% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow07% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow10% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow11% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1arow15% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1axe05% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1axe08% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1axe09% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1axe10% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1axe16% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt01% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt02% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt03% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt04% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt05% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt06% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bolt09% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bull02% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
 
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bull03% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bull04% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bull05% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1bull06% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dagg05% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dagg11% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dagg12% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dagg16% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart01% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart02% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart03% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart04% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart05% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
SET opcode = 83			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 3			// power
SET resist_dispel = 3	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 0 // param1
SET parameter2 = (%1dart08% - 1) // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT

END
BUT_ONLY_IF_IT_CHANGES
END
END


// EE quantity fixes

// Arrows, Bolts, Bullets, and Darts
ACTION_FOR_EACH resource IN
  ~arow01~
  ~arow02~
  ~arow03~
  ~arow04~
  ~arow05~
  ~arow06~
  ~arow07~
  ~arow08~
  ~arow09~
  ~arow10~
  ~arow11~
  ~arow14~
  ~arow15~
  ~bolt01~
  ~bolt02~
  ~bolt03~
  ~bolt04~
  ~bolt05~
  ~bolt06~
  ~bolt07~
  ~bolt08~
  ~bolt09~
  ~sahbolt~
  ~kuobolt~
  ~kuobolt2~
  ~kuobolt3~
  ~bull01~
  ~bull02~
  ~bull03~
  ~bull04~
  ~bull05~
  ~bull06~
  ~dart01~
  ~dart02~
  ~dart03~
  ~dart04~
  ~dart05~
  ~ohdart50~
  ~ohdart51~
BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~%resource%.itm~) BEGIN
    COPY_EXISTING ~%resource%.itm~ ~override\%resource%.itm~
	PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN 
      WRITE_SHORT 0x38 0x50
	END
  END
END

// Throwing Daggers and Throwing Axes
ACTION_FOR_EACH resource IN
  ~dagg05~
  ~dagg16~
  ~ax1h04~
BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~%resource%.itm~) BEGIN
    COPY_EXISTING ~%resource%.itm~ ~override\%resource%.itm~
	PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN 
      WRITE_SHORT 0x38 0x28
	END
  END
END

// Potions
ACTION_FOR_EACH resource IN
  ~potn02~
  ~potn03~
  ~potn04~
  ~potn05~
  ~potn06~
  ~potn07~
  ~potn08~
  ~potn09~
  ~potn10~
  ~potn11~
  ~potn12~
  ~potn13~
  ~potn14~
  ~potn15~
  ~potn16~
  ~potn17~
  ~potn18~
  ~potn19~
  ~potn20~
  ~potn21~
  ~potn22~
  ~potn23~
  ~potn24~
  ~potn25~
  ~potn26~
  ~potn27~
  ~potn28~
  ~potn29~
  ~potn30~
  ~potn31~
  ~potn32~
  ~potn33~
  ~potn34~
  ~potn35~
  ~potn36~
  ~potn37~
  ~potn38~
  ~potn39~
  ~potn40~
  ~potn41~
  ~potn42~
  ~potn43~
  ~potn44~
  ~potn45~
  ~potn46~
  ~potn52~
  ~potn55~  
BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~%resource%.itm~) BEGIN
    COPY_EXISTING ~%resource%.itm~ ~override\%resource%.itm~
	PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN 
      WRITE_SHORT 0x38 0x18
	END
  END
END

// Spell Protections fixes for EEs

ACTION_IF (FILE_EXISTS_IN_GAME ~amul25.spl~) THEN BEGIN // Amulet of Spell Warding's Spell Deflection
COPY_EXISTING ~amul25.spl~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  SET opcode = 201			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 5			// power
SET resist_dispel = 2	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "amul25b" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 9 // param1
SET parameter2 = 1 // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
END
END

ACTION_IF (FILE_EXISTS_IN_GAME ~rods01.spl~) THEN BEGIN // Rod of Absorption's Spell Absorption
COPY_EXISTING ~rods01.spl~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  SET opcode = 201			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 5			// power
SET resist_dispel = 2	// dispel/resitance
SET duration = 0		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "staf11b" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 9 // param1
SET parameter2 = 1 // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
END
END

ACTION_IF (FILE_EXISTS_IN_GAME ~staf11.spl~) THEN BEGIN // Staff of the Magi's Spell Trap
COPY_EXISTING ~staf11.spl~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  SET opcode = 201			// Set opcode
SET target = 1			// target type
SET timing = 0			// timing type
SET power = 9			// power
SET resist_dispel = 2	// dispel/resitance
SET duration = 60		// duration
SET probability1 = 100	// probability 1
SET probability2 = 0	// probability 2
SPRINT "resource" "staf11b" 		// resource
SET dicenumber = 0		// dice number 
SET dicesize = 0		// dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0		// saving throw bonus 
SET parameter1 = 100 // param1
SET parameter2 = 1 // param2
SET header = 1
LAUNCH_PATCH_MACRO ADD_SPELL_EFFECT
END
END

COPY_EXISTING_REGEXP GLOB ~^.+\.itm$~ ~override~ // Fix Shaman usabilities
  PATCH_IF (~%SOURCE_SIZE%~ > ~0x71~) BEGIN
    READ_SHORT 0x1c type
    READ_BYTE 0x31 prof
    PATCH_IF (%prof% = 92) OR (%prof% = 105) OR (%type% = 5) BEGIN // axes or shortbows or arrows
      WRITE_BYTE 0x21 (THIS BAND 0b10111111)
      LPF DELETE_EFFECT INT_VAR silent = 1 match_opcode  = 319 match_target = 1 match_power = 0 match_parameter2 = 5 match_parameter1 = 11 match_timing = 2 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 319 target = 1 power = 0 parameter2 = 5 parameter1 = 11 timing = 2 END
    END
  END
BUT_ONLY

ACTION_IF ee_two_handed_shapeshifts=1 BEGIN // Add two-handed flag for shapeshifts/polymorphs
  ACTION_FOR_EACH resource IN
    ~dvjelly~
    ~dvrat~
    ~dvtroll~
    ~dvwere~
  BEGIN
    ACTION_IF (FILE_EXISTS_IN_GAME ~%resource%.itm~) BEGIN
      COPY_EXISTING ~%resource%.itm~ ~override\%resource%.itm~
	  PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN 
        READ_BYTE 0x18 flags
        WRITE_BYTE 0x18 (%flags% BOR 0b00000010) // Add two-handed flag
	  END
    END
  END
END

ACTION_IF (GAME_IS ~bgee~ AND NOT GAME_IS ~tutu tutu_totsc bg2 tob bgt bg2ee eet~) BEGIN // BG1 fixes
  COPY ~item_rev/itm/belt09.itm~ ~override/belt06.itm~ // Girdle of Trollish Fortitude
    SAY NAME1 @1085    SAY NAME2 @1099
    SAY UNIDENTIFIED_DESC @1087 SAY IDENTIFIED_DESC @1100
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/belt09.spl~ ~override~ // Regeneration
    SAY NAME1 @4004
  COPY ~item_rev/itm/bgmisc89.itm~ ~override/misc89.itm~ // Edwin's Amulet
    SAY NAME1 @1780    SAY NAME2 @1780
    SAY UNIDENTIFIED_DESC @1781 SAY IDENTIFIED_DESC @1781
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/slng05.itm~ ~override/slng03.itm~ // Arla's Dragonbane
    SAY NAME1 @1920    SAY NAME2 @1929
    SAY UNIDENTIFIED_DESC @1923 SAY IDENTIFIED_DESC @1930
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/bgsw2h07.itm~ ~override/sw2h07.itm~ // World's Edge
    SAY NAME1 @1760    SAY NAME2 @2426
    SAY UNIDENTIFIED_DESC @1762 SAY IDENTIFIED_DESC @2427
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/leat07_.itm~ ~override/leat07.itm~ // Telbar's Armor
    SAY NAME1 @1636    SAY NAME2 @2573
    SAY UNIDENTIFIED_DESC @1640 SAY IDENTIFIED_DESC @2574
	LPF update_item_descriptions_to_bgee END
  // Shields
  COPY ~item_rev/itm/shld01a.itm~ ~override/shld01.itm~
    SAY NAME1 @1939    SAY NAME2 @1939
    SAY UNIDENTIFIED_DESC @1940 SAY IDENTIFIED_DESC @1940
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld02a.itm~ ~override/shld02.itm~
    SAY NAME1 @1939    SAY NAME2 @1941
    SAY UNIDENTIFIED_DESC @1942 SAY IDENTIFIED_DESC @1943
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld03a.itm~ ~override/shld03.itm~
    SAY NAME1 @1501    SAY NAME2 @1501
    SAY UNIDENTIFIED_DESC @1944 SAY IDENTIFIED_DESC @1944
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld04a.itm~ ~override/shld04.itm~
    SAY NAME1 @1501    SAY NAME2 @1945
    SAY UNIDENTIFIED_DESC @1503 SAY IDENTIFIED_DESC @1946
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld05a.itm~ ~override/shld05.itm~
    SAY NAME1 @1947    SAY NAME2 @1947
    SAY UNIDENTIFIED_DESC @1948 SAY IDENTIFIED_DESC @1948
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld06a.itm~ ~override/shld06.itm~
    SAY NAME1 @1947    SAY NAME2 @1949
    SAY UNIDENTIFIED_DESC @1950 SAY IDENTIFIED_DESC @1951
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld07a.itm~ ~override/shld07.itm~
    SAY NAME1 @1947    SAY NAME2 @1953
    SAY UNIDENTIFIED_DESC @1950 SAY IDENTIFIED_DESC @1954
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld08a.itm~ ~override/shld08.itm~
    SAY NAME1 @1955    SAY NAME2 @1955
    SAY UNIDENTIFIED_DESC @1956 SAY IDENTIFIED_DESC @1956
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld09a.itm~ ~override/shld09.itm~
    SAY NAME1 @1955    SAY NAME2 @1955
    SAY UNIDENTIFIED_DESC @1956 SAY IDENTIFIED_DESC @1956
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld10a.itm~ ~override/shld10.itm~
    SAY NAME1 @1955    SAY NAME2 @1955
    SAY UNIDENTIFIED_DESC @1956 SAY IDENTIFIED_DESC @1956
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld11a.itm~ ~override/shld11.itm~
    SAY NAME1 @1939    SAY NAME2 @1939
    SAY UNIDENTIFIED_DESC @1940 SAY IDENTIFIED_DESC @1940
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld12a.itm~ ~override/shld12.itm~
    SAY NAME1 @1939    SAY NAME2 @1939
    SAY UNIDENTIFIED_DESC @1940 SAY IDENTIFIED_DESC @1940
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld13a.itm~ ~override/shld13.itm~
    SAY NAME1 @1501    SAY NAME2 @1501
    SAY UNIDENTIFIED_DESC @1944 SAY IDENTIFIED_DESC @1944
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld14a.itm~ ~override/shld14.itm~
    SAY NAME1 @1501    SAY NAME2 @1501
    SAY UNIDENTIFIED_DESC @1944 SAY IDENTIFIED_DESC @1944
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld15a.itm~ ~override/shld15.itm~
    SAY NAME1 @1947    SAY NAME2 @1947
    SAY UNIDENTIFIED_DESC @1948 SAY IDENTIFIED_DESC @1948
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld16a.itm~ ~override/shld16.itm~
    SAY NAME1 @1947    SAY NAME2 @1947
    SAY UNIDENTIFIED_DESC @1948 SAY IDENTIFIED_DESC @1948
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld17a.itm~ ~override/shld17.itm~
    SAY NAME1 @1955    SAY NAME2 @1957
    SAY UNIDENTIFIED_DESC @1958 SAY IDENTIFIED_DESC @1959
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld19a.itm~ ~override/shld19.itm~
    SAY NAME1 @1501    SAY NAME2 @1960
    SAY UNIDENTIFIED_DESC @1944 SAY IDENTIFIED_DESC @1961
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld28a.itm~ ~override/shld28.itm~
    SAY NAME1 @1939    SAY NAME2 @1978
    SAY UNIDENTIFIED_DESC @1942 SAY IDENTIFIED_DESC @1979
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld29a.itm~ ~override/shld29.itm~
    SAY NAME1 @1501    SAY NAME2 @1980
    SAY UNIDENTIFIED_DESC @1942 SAY IDENTIFIED_DESC @1979
	LPF update_item_descriptions_to_bgee END
  COPY ~item_rev/itm/shld30a.itm~ ~override/shld30.itm~
    SAY NAME1 @1947    SAY NAME2 @1982
    SAY UNIDENTIFIED_DESC @1950 SAY IDENTIFIED_DESC @1983
	LPF update_item_descriptions_to_bgee END
END

ACTION_IF (GAME_IS ~eet~ AND NOT GAME_IS ~tutu tutu_totsc bgee bg2 tob bgt bg2ee~) BEGIN // EET fixes
  ACTION_IF (FILE_EXISTS_IN_GAME ~helm15_.itm~) THEN BEGIN
    COPY_EXISTING ~helm15.itm~ ~override/helm15_.itm~
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~misc89_.itm~) THEN BEGIN
    COPY_EXISTING ~bgmisc89.itm~ ~override/misc89_.itm~
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~ring08_.itm~) THEN BEGIN
    COPY_EXISTING ~bgring08.itm~ ~override/ring08_.itm~
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~staf08_.itm~) THEN BEGIN
    COPY_EXISTING ~staf08.itm~ ~override/staf08_.itm~
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~sw1h09_.itm~) THEN BEGIN
    COPY_EXISTING ~sw1h09.itm~ ~override/sw1h09_.itm~
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~sw2h07_.itm~) THEN BEGIN
    COPY_EXISTING ~bgsw2h07.itm~ ~override/sw2h07_.itm~
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~wand12_.itm~) THEN BEGIN
    COPY_EXISTING ~bgwand12.itm~ ~override/wand12_.itm~
  END
END

END


// Non-EE fixes

ACTION_IF (GAME_IS ~tutu tutu_totsc~ AND NOT GAME_IS ~bg2 tob bgt bgee bg2ee eet~) BEGIN // BG1 fixes
  COPY ~item_rev/itm/belt09.itm~ ~override/belt06.itm~ // Girdle of Trollish Fortitude
    SAY NAME1 @1085    SAY NAME2 @1099
    SAY UNIDENTIFIED_DESC @1087 SAY IDENTIFIED_DESC @1100
  COPY ~item_rev/itm/belt09.spl~ ~override~ // Regeneration
    SAY NAME1 @4004
  COPY ~item_rev/itm/bgmisc89.itm~ ~override/misc89.itm~ // Edwin's Amulet
    SAY NAME1 @1780    SAY NAME2 @1780
    SAY UNIDENTIFIED_DESC @1781 SAY IDENTIFIED_DESC @1781
  COPY ~item_rev/itm/slng05.itm~ ~override/slng03.itm~ // Arla's Dragonbane
    SAY NAME1 @1920    SAY NAME2 @1929
    SAY UNIDENTIFIED_DESC @1923 SAY IDENTIFIED_DESC @1930
  COPY ~item_rev/itm/bgsw2h07.itm~ ~override/sw2h07.itm~ // World's Edge
    SAY NAME1 @1760    SAY NAME2 @2426
    SAY UNIDENTIFIED_DESC @1762 SAY IDENTIFIED_DESC @2427
  COPY ~item_rev/itm/leat07_.itm~ ~override/leat07.itm~ // Telbar's Armor
    SAY NAME1 @1636    SAY NAME2 @2573
    SAY UNIDENTIFIED_DESC @1640 SAY IDENTIFIED_DESC @2574
END

ACTION_IF (GAME_IS ~tutu tutu_totsc bg2 tob bgt~ AND NOT GAME_IS ~bgee bg2ee eet~) BEGIN // Invalid opcodes fix
  COPY_EXISTING_REGEXP GLOB ~^.+\.spl$~ override // remove spellstates
    GET_OFFSET_ARRAY ab_array SPL_V10_HEADERS
    PHP_EACH ab_array AS int => ab_off BEGIN
      GET_OFFSET_ARRAY2 fx_array ab_off ITM_V10_HEAD_EFFECTS
      PHP_EACH fx_array AS int => fx_off BEGIN
        READ_SHORT fx_off fx_type
        PATCH_IF fx_type > 318 BEGIN
          //PATCH_PRINT "%SOURCE_RES%.spl has invalid opcode %fx_type%"
        END
      END
    END
  BUT_ONLY
  COPY_EXISTING_REGEXP GLOB ~^.+\.spl$~ override
    LPF DELETE_SPELL_EFFECT
      INT_VAR opcode_to_delete = 321
	END
    LPF DELETE_SPELL_EFFECT
      INT_VAR opcode_to_delete = 328
    END
  BUT_ONLY
  //PRINT "All invalid opcodes 321 and 328 successfully removed!"
END


// All games

DEFINE_PATCH_MACRO ~nostack~ BEGIN // Stacking fixes
SET opcode = 0      // Set opcode
SET target = 0      // target type
SET timing = 2      // timing type
SET power = 0      // power
SET resist_dispel = 0  // dispel/resitance
SET duration = 0    // duration
SET probability1 = 0  // probability 1
SET probability2 = 0  // probability 2
SPRINT "resource" ""     // resource
SET dicenumber = 0    // dice number 
SET dicesize = 0    // dice size
SET savingthrow = 0   // saving throw
SET savebonus = 0    // saving throw bonus 
SET parameter1 = 0 // set parameter 1
SET parameter2 = 0 // set parameter 2
LAUNCH_PATCH_MACRO ADD_ITEM_EQEFFECT
END

ACTION_FOR_EACH resource IN
  ~bgscrl3i~ // Mirianne's Scroll
  ~misc6o~   // Sun Gem
  ~misc6n~   // Sun Gem
  ~ringjoia~ // Joia's Flamedance Ring
  ~ringjos~  // Joseph's Greenstone Ring
  ~scrl3i~   // Mirianne's Scroll
  ~scrl3z~   // Gorion's Scroll
  ~scrldra~  // Drasus's Scroll
  ~scrlkar~  // Karlat's Bounty Notice
  ~scrlnei~  // Neira's Bounty Notice
  ~scrltar~  // Tarnesh's Bounty Notice
BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~%resource%.itm~) BEGIN
    COPY_EXISTING ~%resource%.itm~ ~override\%resource%.itm~
	PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN 
      LAUNCH_PATCH_MACRO ~nostack~
	END
  END
END

// BG2 broken areas fix
ACTION_IF (FILE_EXISTS_IN_GAME ~xr1200.are~) THEN BEGIN
  COPY_EXISTING ~xr1200.are~ ~override/xr2400.are~
  COPY_EXISTING ~xr1200.are~ ~override/xr2600.are~
END

// Item charges fixes

// Wands

COPY_EXISTING_REGEXP ~^.+\.cre$~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x2d3) BEGIN
    PATCH_FOR_EACH ~item~ IN // Wands
      ~WAND02~   // Wand of Fear
      ~WAND03~   // Wand of Magic Missile
      ~WAND04~   // Wand of Paralyzation
      ~WAND05~   // Wand of Fire
      ~WAND06~   // Wand of Frost
      ~WAND07~   // Wand of Lightning
      ~WAND08~   // Wand of Sleep
      ~WAND09~   // Wand of Polymorphing
      ~WAND10~   // Wand of Monster Summoning
      ~WAND11~   // Wand of the Heavens
      ~WAND12~   // Wand of Magic Missiles (BGEE)
      ~BGWAND12~ // Wand of Magic Missiles (BGT)
      ~WAND12_~  // Wand of Magic Missiles (EET)
      ~WAND13~   // Wand of Cloudkill
      ~WAND18~   // Wand of Spell Striking
      ~WAND19~   // Wand of Cursing
      ~BDWAND01~ // Wand of Water Elemental Summoning (BGSOD)
    BEGIN
      PATCH_IF (FILE_EXISTS_IN_GAME ~%item%.itm~) BEGIN
        GET_OFFSET_ARRAY itm_array CRE_V10_ITEMS
        PHP_EACH ~itm_array~ AS ~int~ => ~itm_offset~ BEGIN
          READ_ASCII (itm_offset + 0x0) resref
          PATCH_IF (~%resref%~ STRING_EQUAL_CASE ~%item%~) BEGIN
            READ_SHORT (itm_offset + 0xa) charges_1
            PATCH_IF (charges_1 > 10) BEGIN
              PATCH_PRINT "~%SOURCE_FILE%~: ~%item%.itm~, primary charges: %charges_1% => setting them to 10..."
              WRITE_SHORT (itm_offset + 0xa) 10
            END
          END
        END
      END
    END
    PATCH_FOR_EACH ~item~ IN // 1 charge
      ~AMUL20~   // Kaligum's Amulet of Magic Resistance
      ~AMUL25~   // Amulet of Spell Warding
      ~AMUL26~   // Amulet of Cheetah Speed
      ~BELT09~   // Girdle of Trollish Fortitude
      //~BLUN27~   // Club of Detonation +5 (2nd)
      ~BOOT09~   // Boots of the Shifting Sands
      ~BOOT11~   // Boots of Etherealness
      //~BOW20~   // Darkfire Bow +4 (2nd)
      //~BOW21~   // Darkfire Bow +5 (2nd)
      ~BRAC16~   // Bracers of the Blinding Strike
      ~BRAC20~   // Gauntlets of Healing
      ~BRAC23~   // Blessed Bracers
      //~BRAC23~   // Blessed Bracers (2nd)
      ~CHAN10~   // Prismatic Chain +4
      ~CLCK04~   // Cloak of the Wolf
      ~CLCK07~   // Cloak of the Nymph
      ~CCLCK08~   // Algernon's Cloak
      ~CLCK27~   // Cloak of the Sewers
      //~CLCK27~   // Cloak of the Sewers (2nd)
      //~HALB10~   // Ravager +4 (2nd)
      //~HAMM11~   // Runehammer +5 (2nd)
      //~HAMM11~   // Runehammer +5 (3rd)
      ~HELM16~   // Helm of Brilliance
      //~HELM16~   // Helm of Brilliance (2nd)
      //~HELM16~   // Helm of Brilliance (3rd)
      ~HELM17~   // Skull of Death
      ~HELM18~   // Pearly White Ioun Stone
      ~HELM30~   // Master Thief's Hood
      ~LEAT18~   // Armor of the Viper +4
      ~MISC2P~   // Greagan's Harp
      ~MISC3A~   // Book of Infinite Spells
      ~MISC3C~   // Efreeti Bottle
      ~MISC3D~   // Golden Lion Figurine
      ~MISC3E~   // Black Spider Figurine
      ~MISC3F~   // Jade Hound Figurine
      ~MISC3I~   // Silver Horn of Valhalla
      ~MISC3J~   // Bronze Horn of Valhalla
      ~MISC3K~   // Iron Horn of Valhalla
      ~MISC73~   // The Horn of Kazgaroth
      //~MISC5T~   // Shaman's Staff (2nd)
      ~MISC7T~   // Moon Dog Figurine
      ~MISC7Y~   // Thrall Collar
      ~FIGURE01~   // Shakti Figurine
      ~TOME01~   // Flesh Golem Manual
      ~TOME02~   // Clay Golem Manual
      ~TOME03~   // Stone Golem Manual
      ~TOME04~   // Juggernaut Golem Manual
      ~NPMISC1~   // Jansen Spectroscopes
      ~NPSHLD~   // Delryn Family Shield +2
      ~VICARM~   // Shar's Blessing +5
      ~RING20~   // Ring of Energy
      ~RING26~   // Ring of Djinni Summoning
      ~RING27~   // Ring of Fire Control
      //~RING27~   // Ring of Fire Control (2nd)
      ~RING28~   // Ring of Air Control
      //~RING28~   // Ring of Air Control (2nd)
      ~RING29~   // Ring of Earth Control
      //~RING29~   // Ring of Earth Control (2nd)
      ~RING30~   // Ring of Human Influence
      ~RING34~   // Ring of Spell Turning
      //~RING39~   // Ring of Kangaxx (2nd)
      ~RING42~   // Ring of the Wraith
      ~RODS01~   // Rod of Absorption
      ~RODS03~   // Rod of Resurrection
      ~RODS06~   // Rod of Reversal
      //~STAF09~   // Staff of Command +3 (2nd)
      //~STAF10~   // Staff of Curing +1 (2nd)
      //~STAF11~   // Staff of the Magi +5 (2nd)
      //~STAF11~   // Staff of the Magi +5 (3rd)
      //~STAF12~   // Staff of Power +3 (2nd)
      //~STAF12~   // Staff of Power +3 (3rd)
      //~STAF13~   // Staff of Thunder and Lightning +2 (2nd)
      //~STAF13~   // Staff of Thunder and Lightning +2 (3rd)
      //~STAF14~   // Staff of the Woodlands (2nd)
      //~STAF14~   // Staff of the Woodlands (3rd)
      //~STAF15~   // Staff of Air +2 (2nd)
      //~STAF16~   // Staff of Earth +2 (2nd)
      //~STAF17~   // Staff of Fire +2 (2nd)
      //~STAF20~   // Staff of Rynn +3 (2nd)
      //~SW1H26~   // Ilbratha +1 (2nd)
      //~SW1H31~   // Daystar +4 (2nd)
      //~SW1H33~   // Ras +2 (2nd)
      //~SW1H51~   // Celestial Fury (3rd)
      //~SW1H64~   // Purifier +5 (2nd)
      //~SW1H65~   // Purifier +5 (3rd)
      //~SW1H68~   // Spectral Brand +4 (2nd)
      //~SW1H69~   // Spectral Brand +5 (2nd)
      //~SW1H69~   // Spectral Brand +5 (3rd)
      //~SW1H70~   // Hindo's Doom +4 (2nd)
      //~SW1H70~   // Hindo's Doom +5 (3rd)
      //~SW2H10~   // Carsomyr +4 (2nd)
      ~WA2HELM~   // Shadow Veil
      ~WAND14~   // Web Sack
      ~WAND15~   // Rod of the Apprenti
      //~WAND15~   // Rod of the Apprenti (2nd)
      //~WAND15~   // Rod of the Apprenti (3rd)
    BEGIN
      PATCH_IF (FILE_EXISTS_IN_GAME ~%item%.itm~) BEGIN
        GET_OFFSET_ARRAY itm_array CRE_V10_ITEMS
        PHP_EACH ~itm_array~ AS ~int~ => ~itm_offset~ BEGIN
          READ_ASCII (itm_offset + 0x0) resref
          PATCH_IF (~%resref%~ STRING_EQUAL_CASE ~%item%~) BEGIN
          READ_SHORT (itm_offset + 0xa) charges_1
            PATCH_IF (charges_1 > 1) BEGIN
              PATCH_IF (charges_1 < 1) BEGIN
                PATCH_PRINT "~%SOURCE_FILE%~: ~%item%.itm~, primary charges: %charges_1% => setting them to 1..."
                WRITE_SHORT (itm_offset + 0xa) 1
              END
			END
          END
        END
      END
    END
    PATCH_FOR_EACH ~item~ IN // 3 charges
      ~BOOT12~   // Gargoyle Boots
      //~HALB06~   // Blackmist +4 (2nd)
      //~HALB11~   // Ravager +5 (2nd)
      ~HELM31~   // Horned Helm of the Rock
      ~MISC3H~   // Horn of Blasting
      ~MISC3L~   // Horn of Silence
      ~MISC3M~   // Harp of Discord
      ~MISC3N~   // Azlaer's Harp
      ~MISC3O~   // Methild's Harp
      ~MISC3P~   // Glasses of Identification
      ~RING05~   // Ring of Invisibility
      ~RING33~   // Ring of the Ram
      ~RING39~   // Ring of Kangaxx
      //~SW1H51~   // Celestial Fury (2nd)
      ~WAND12~   // Rod of Wonder
      ~REGISAMU~ // Ruby Pendant of Beguiling
      ~WA2HARP~  // Harp of Pandemonium
    BEGIN
      PATCH_IF (FILE_EXISTS_IN_GAME ~%item%.itm~) BEGIN
        GET_OFFSET_ARRAY itm_array CRE_V10_ITEMS
        PHP_EACH ~itm_array~ AS ~int~ => ~itm_offset~ BEGIN
          READ_ASCII (itm_offset + 0x0) resref
          PATCH_IF (~%resref%~ STRING_EQUAL_CASE ~%item%~) BEGIN
            READ_SHORT (itm_offset + 0xa) charges_1
            PATCH_IF (charges_1 > 3) BEGIN
              PATCH_IF (charges_1 < 3) BEGIN
                PATCH_PRINT "~%SOURCE_FILE%~: ~%item%.itm~, primary charges: %charges_1% => setting them to 3..."
                WRITE_SHORT (itm_offset + 0xa) 3
              END
			END
          END
        END
      END
    END
  END
BUT_ONLY

COPY_EXISTING_REGEXP ~^.+\.sto$~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x9b) BEGIN
    PATCH_FOR_EACH ~item~ IN // Wands
      ~WAND02~   // Wand of Fear
      ~WAND03~   // Wand of Magic Missile
      ~WAND04~   // Wand of Paralyzation
      ~WAND05~   // Wand of Fire
      ~WAND06~   // Wand of Frost
      ~WAND07~   // Wand of Lightning
      ~WAND08~   // Wand of Sleep
      ~WAND09~   // Wand of Polymorphing
      ~WAND10~   // Wand of Monster Summoning
      ~WAND11~   // Wand of the Heavens
      ~WAND12~   // Wand of Magic Missiles (BGEE)
      ~BGWAND12~ // Wand of Magic Missiles (BGT)
      ~WAND12_~  // Wand of Magic Missiles (EET)
      ~WAND13~   // Wand of Cloudkill
      ~WAND18~   // Wand of Spell Striking
      ~WAND19~   // Wand of Cursing
      ~BDWAND01~ // Wand of Water Elemental Summoning (BGSOD)
    BEGIN
      PATCH_IF (FILE_EXISTS_IN_GAME ~%item%.itm~) BEGIN
        GET_OFFSET_ARRAY itm_array STO_V10_ITEMS_SOLD
        PHP_EACH ~itm_array~ AS ~int~ => ~itm_offset~ BEGIN
          READ_ASCII (itm_offset + 0x0) resref
          PATCH_IF (~%resref%~ STRING_EQUAL_CASE ~%item%~) BEGIN
            READ_SHORT (itm_offset + 0xa) charges_1
            PATCH_IF (charges_1 > 10) BEGIN
              PATCH_PRINT "~%SOURCE_FILE%~: ~%item%.itm~, primary charges: %charges_1% => setting them to 10..."
              WRITE_SHORT (itm_offset + 0xa) 10
            END
          END
        END
      END
    END
    PATCH_FOR_EACH ~item~ IN // 1 charge
      ~AMUL20~   // Kaligum's Amulet of Magic Resistance
      ~AMUL25~   // Amulet of Spell Warding
      ~AMUL26~   // Amulet of Cheetah Speed
      ~BELT09~   // Girdle of Trollish Fortitude
      //~BLUN27~   // Club of Detonation +5 (2nd)
      ~BOOT09~   // Boots of the Shifting Sands
      ~BOOT11~   // Boots of Etherealness
      //~BOW20~   // Darkfire Bow +4 (2nd)
      //~BOW21~   // Darkfire Bow +5 (2nd)
      ~BRAC16~   // Bracers of the Blinding Strike
      ~BRAC20~   // Gauntlets of Healing
      ~BRAC23~   // Blessed Bracers
      //~BRAC23~   // Blessed Bracers (2nd)
      ~CHAN10~   // Prismatic Chain +4
      ~CLCK04~   // Cloak of the Wolf
      ~CLCK07~   // Cloak of the Nymph
      ~CCLCK08~   // Algernon's Cloak
      ~CLCK27~   // Cloak of the Sewers
      //~CLCK27~   // Cloak of the Sewers (2nd)
      //~HALB10~   // Ravager +4 (2nd)
      //~HAMM11~   // Runehammer +5 (2nd)
      //~HAMM11~   // Runehammer +5 (3rd)
      ~HELM16~   // Helm of Brilliance
      //~HELM16~   // Helm of Brilliance (2nd)
      //~HELM16~   // Helm of Brilliance (3rd)
      ~HELM17~   // Skull of Death
      ~HELM18~   // Pearly White Ioun Stone
      ~HELM30~   // Master Thief's Hood
      ~LEAT18~   // Armor of the Viper +4
      ~MISC2P~   // Greagan's Harp
      ~MISC3A~   // Book of Infinite Spells
      ~MISC3C~   // Efreeti Bottle
      ~MISC3D~   // Golden Lion Figurine
      ~MISC3E~   // Black Spider Figurine
      ~MISC3F~   // Jade Hound Figurine
      ~MISC3I~   // Silver Horn of Valhalla
      ~MISC3J~   // Bronze Horn of Valhalla
      ~MISC3K~   // Iron Horn of Valhalla
      ~MISC73~   // The Horn of Kazgaroth
      //~MISC5T~   // Shaman's Staff (2nd)
      ~MISC7T~   // Moon Dog Figurine
      ~MISC7Y~   // Thrall Collar
      ~FIGURE01~   // Shakti Figurine
      ~TOME01~   // Flesh Golem Manual
      ~TOME02~   // Clay Golem Manual
      ~TOME03~   // Stone Golem Manual
      ~TOME04~   // Juggernaut Golem Manual
      ~NPMISC1~   // Jansen Spectroscopes
      ~NPSHLD~   // Delryn Family Shield +2
      ~VICARM~   // Shar's Blessing +5
      ~RING20~   // Ring of Energy
      ~RING26~   // Ring of Djinni Summoning
      ~RING27~   // Ring of Fire Control
      //~RING27~   // Ring of Fire Control (2nd)
      ~RING28~   // Ring of Air Control
      //~RING28~   // Ring of Air Control (2nd)
      ~RING29~   // Ring of Earth Control
      //~RING29~   // Ring of Earth Control (2nd)
      ~RING30~   // Ring of Human Influence
      ~RING34~   // Ring of Spell Turning
      //~RING39~   // Ring of Kangaxx (2nd)
      ~RING42~   // Ring of the Wraith
      ~RODS01~   // Rod of Absorption
      ~RODS03~   // Rod of Resurrection
      ~RODS06~   // Rod of Reversal
      //~STAF09~   // Staff of Command +3 (2nd)
      //~STAF10~   // Staff of Curing +1 (2nd)
      //~STAF11~   // Staff of the Magi +5 (2nd)
      //~STAF11~   // Staff of the Magi +5 (3rd)
      //~STAF12~   // Staff of Power +3 (2nd)
      //~STAF12~   // Staff of Power +3 (3rd)
      //~STAF13~   // Staff of Thunder and Lightning +2 (2nd)
      //~STAF13~   // Staff of Thunder and Lightning +2 (3rd)
      //~STAF14~   // Staff of the Woodlands (2nd)
      //~STAF14~   // Staff of the Woodlands (3rd)
      //~STAF15~   // Staff of Air +2 (2nd)
      //~STAF16~   // Staff of Earth +2 (2nd)
      //~STAF17~   // Staff of Fire +2 (2nd)
      //~STAF20~   // Staff of Rynn +3 (2nd)
      //~SW1H26~   // Ilbratha +1 (2nd)
      //~SW1H31~   // Daystar +4 (2nd)
      //~SW1H33~   // Ras +2 (2nd)
      //~SW1H51~   // Celestial Fury (3rd)
      //~SW1H64~   // Purifier +5 (2nd)
      //~SW1H65~   // Purifier +5 (3rd)
      //~SW1H68~   // Spectral Brand +4 (2nd)
      //~SW1H69~   // Spectral Brand +5 (2nd)
      //~SW1H69~   // Spectral Brand +5 (3rd)
      //~SW1H70~   // Hindo's Doom +4 (2nd)
      //~SW1H70~   // Hindo's Doom +5 (3rd)
      //~SW2H10~   // Carsomyr +4 (2nd)
      ~WA2HELM~   // Shadow Veil
      ~WAND14~   // Web Sack
      ~WAND15~   // Rod of the Apprenti
      //~WAND15~   // Rod of the Apprenti (2nd)
      //~WAND15~   // Rod of the Apprenti (3rd)
    BEGIN
      PATCH_IF (FILE_EXISTS_IN_GAME ~%item%.itm~) BEGIN
        GET_OFFSET_ARRAY itm_array STO_V10_ITEMS_SOLD
        PHP_EACH ~itm_array~ AS ~int~ => ~itm_offset~ BEGIN
          READ_ASCII (itm_offset + 0x0) resref
          PATCH_IF (~%resref%~ STRING_EQUAL_CASE ~%item%~) BEGIN
            READ_SHORT (itm_offset + 0xa) charges_1
            PATCH_IF (charges_1 > 1) BEGIN
              PATCH_IF (charges_1 < 1) BEGIN
                PATCH_PRINT "~%SOURCE_FILE%~: ~%item%.itm~, primary charges: %charges_1% => setting them to 1..."
                WRITE_SHORT (itm_offset + 0xa) 1
              END
			END
          END
        END
      END
    END
    PATCH_FOR_EACH ~item~ IN // 3 charges
      ~BOOT12~   // Gargoyle Boots
      //~HALB06~   // Blackmist +4 (2nd)
      //~HALB11~   // Ravager +5 (2nd)
      ~HELM31~   // Horned Helm of the Rock
      ~MISC3H~   // Horn of Blasting
      ~MISC3L~   // Horn of Silence
      ~MISC3M~   // Harp of Discord
      ~MISC3N~   // Azlaer's Harp
      ~MISC3O~   // Methild's Harp
      ~MISC3P~   // Glasses of Identification
      ~RING05~   // Ring of Invisibility
      ~RING33~   // Ring of the Ram
      ~RING39~   // Ring of Kangaxx
      //~SW1H51~   // Celestial Fury (2nd)
      ~WAND12~   // Rod of Wonder
      ~REGISAMU~ // Ruby Pendant of Beguiling
      ~WA2HARP~  // Harp of Pandemonium
    BEGIN
      PATCH_IF (FILE_EXISTS_IN_GAME ~%item%.itm~) BEGIN
        GET_OFFSET_ARRAY itm_array STO_V10_ITEMS_SOLD
        PHP_EACH ~itm_array~ AS ~int~ => ~itm_offset~ BEGIN
          READ_ASCII (itm_offset + 0x0) resref
          PATCH_IF (~%resref%~ STRING_EQUAL_CASE ~%item%~) BEGIN
            READ_SHORT (itm_offset + 0xa) charges_1
            PATCH_IF (charges_1 > 3) BEGIN
              PATCH_IF (charges_1 < 3) BEGIN
                PATCH_PRINT "~%SOURCE_FILE%~: ~%item%.itm~, primary charges: %charges_1% => setting them to 3..."
                WRITE_SHORT (itm_offset + 0xa) 3
              END
			END
          END
        END
      END
    END
  END
BUT_ONLY

COPY_EXISTING_REGEXP ~^.+\.are$~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x11b) BEGIN
    PATCH_FOR_EACH ~item~ IN // Wands
      ~WAND02~   // Wand of Fear
      ~WAND03~   // Wand of Magic Missile
      ~WAND04~   // Wand of Paralyzation
      ~WAND05~   // Wand of Fire
      ~WAND06~   // Wand of Frost
      ~WAND07~   // Wand of Lightning
      ~WAND08~   // Wand of Sleep
      ~WAND09~   // Wand of Polymorphing
      ~WAND10~   // Wand of Monster Summoning
      ~WAND11~   // Wand of the Heavens
      ~WAND12~   // Wand of Magic Missiles (BGEE)
      ~BGWAND12~ // Wand of Magic Missiles (BGT)
      ~WAND12_~  // Wand of Magic Missiles (EET)
      ~WAND13~   // Wand of Cloudkill
      ~WAND18~   // Wand of Spell Striking
      ~WAND19~   // Wand of Cursing
      ~BDWAND01~ // Wand of Water Elemental Summoning (BGSOD)
    BEGIN
      PATCH_IF (FILE_EXISTS_IN_GAME ~%item%.itm~) BEGIN
        GET_OFFSET_ARRAY container_array ARE_V10_CONTAINERS
        PHP_EACH ~container_array~ AS ~int~ => ~container_offset~ BEGIN
          GET_OFFSET_ARRAY2 itm_array container_offset ARE_V10_ITEMS
          PHP_EACH ~itm_array~ AS ~int~ => ~itm_offset~ BEGIN
            READ_ASCII (itm_offset + 0x0) resref
            PATCH_IF (~%resref%~ STRING_EQUAL_CASE ~%item%~) BEGIN
              READ_ASCII (container_offset + 0x0) container_name (32) NULL
              READ_SHORT (itm_offset + 0xa) charges_1
              PATCH_IF (charges_1 > 10) BEGIN
                PATCH_PRINT "~%SOURCE_FILE%~: ~%container_name%~, ~%item%.itm~, primary charges: %charges_1% => setting them to 10..."
                WRITE_SHORT (itm_offset + 0xa) 10
              END
            END
          END
        END
      END
    END
    PATCH_FOR_EACH ~item~ IN // 1 charge
      ~AMUL20~   // Kaligum's Amulet of Magic Resistance
      ~AMUL25~   // Amulet of Spell Warding
      ~AMUL26~   // Amulet of Cheetah Speed
      ~BELT09~   // Girdle of Trollish Fortitude
      //~BLUN27~   // Club of Detonation +5 (2nd)
      ~BOOT09~   // Boots of the Shifting Sands
      ~BOOT11~   // Boots of Etherealness
      //~BOW20~   // Darkfire Bow +4 (2nd)
      //~BOW21~   // Darkfire Bow +5 (2nd)
      ~BRAC16~   // Bracers of the Blinding Strike
      ~BRAC20~   // Gauntlets of Healing
      ~BRAC23~   // Blessed Bracers
      //~BRAC23~   // Blessed Bracers (2nd)
      ~CHAN10~   // Prismatic Chain +4
      ~CLCK04~   // Cloak of the Wolf
      ~CLCK07~   // Cloak of the Nymph
      ~CCLCK08~   // Algernon's Cloak
      ~CLCK27~   // Cloak of the Sewers
      //~CLCK27~   // Cloak of the Sewers (2nd)
      //~HALB10~   // Ravager +4 (2nd)
      //~HAMM11~   // Runehammer +5 (2nd)
      //~HAMM11~   // Runehammer +5 (3rd)
      ~HELM16~   // Helm of Brilliance
      //~HELM16~   // Helm of Brilliance (2nd)
      //~HELM16~   // Helm of Brilliance (3rd)
      ~HELM17~   // Skull of Death
      ~HELM18~   // Pearly White Ioun Stone
      ~HELM30~   // Master Thief's Hood
      ~LEAT18~   // Armor of the Viper +4
      ~MISC2P~   // Greagan's Harp
      ~MISC3A~   // Book of Infinite Spells
      ~MISC3C~   // Efreeti Bottle
      ~MISC3D~   // Golden Lion Figurine
      ~MISC3E~   // Black Spider Figurine
      ~MISC3F~   // Jade Hound Figurine
      ~MISC3I~   // Silver Horn of Valhalla
      ~MISC3J~   // Bronze Horn of Valhalla
      ~MISC3K~   // Iron Horn of Valhalla
      ~MISC73~   // The Horn of Kazgaroth
      //~MISC5T~   // Shaman's Staff (2nd)
      ~MISC7T~   // Moon Dog Figurine
      ~MISC7Y~   // Thrall Collar
      ~FIGURE01~   // Shakti Figurine
      ~TOME01~   // Flesh Golem Manual
      ~TOME02~   // Clay Golem Manual
      ~TOME03~   // Stone Golem Manual
      ~TOME04~   // Juggernaut Golem Manual
      ~NPMISC1~   // Jansen Spectroscopes
      ~NPSHLD~   // Delryn Family Shield +2
      ~VICARM~   // Shar's Blessing +5
      ~RING20~   // Ring of Energy
      ~RING26~   // Ring of Djinni Summoning
      ~RING27~   // Ring of Fire Control
      //~RING27~   // Ring of Fire Control (2nd)
      ~RING28~   // Ring of Air Control
      //~RING28~   // Ring of Air Control (2nd)
      ~RING29~   // Ring of Earth Control
      //~RING29~   // Ring of Earth Control (2nd)
      ~RING30~   // Ring of Human Influence
      ~RING34~   // Ring of Spell Turning
      //~RING39~   // Ring of Kangaxx (2nd)
      ~RING42~   // Ring of the Wraith
      ~RODS01~   // Rod of Absorption
      ~RODS03~   // Rod of Resurrection
      ~RODS06~   // Rod of Reversal
      //~STAF09~   // Staff of Command +3 (2nd)
      //~STAF10~   // Staff of Curing +1 (2nd)
      //~STAF11~   // Staff of the Magi +5 (2nd)
      //~STAF11~   // Staff of the Magi +5 (3rd)
      //~STAF12~   // Staff of Power +3 (2nd)
      //~STAF12~   // Staff of Power +3 (3rd)
      //~STAF13~   // Staff of Thunder and Lightning +2 (2nd)
      //~STAF13~   // Staff of Thunder and Lightning +2 (3rd)
      //~STAF14~   // Staff of the Woodlands (2nd)
      //~STAF14~   // Staff of the Woodlands (3rd)
      //~STAF15~   // Staff of Air +2 (2nd)
      //~STAF16~   // Staff of Earth +2 (2nd)
      //~STAF17~   // Staff of Fire +2 (2nd)
      //~STAF20~   // Staff of Rynn +3 (2nd)
      //~SW1H26~   // Ilbratha +1 (2nd)
      //~SW1H31~   // Daystar +4 (2nd)
      //~SW1H33~   // Ras +2 (2nd)
      //~SW1H51~   // Celestial Fury (3rd)
      //~SW1H64~   // Purifier +5 (2nd)
      //~SW1H65~   // Purifier +5 (3rd)
      //~SW1H68~   // Spectral Brand +4 (2nd)
      //~SW1H69~   // Spectral Brand +5 (2nd)
      //~SW1H69~   // Spectral Brand +5 (3rd)
      //~SW1H70~   // Hindo's Doom +4 (2nd)
      //~SW1H70~   // Hindo's Doom +5 (3rd)
      //~SW2H10~   // Carsomyr +4 (2nd)
      ~WA2HELM~   // Shadow Veil
      ~WAND14~   // Web Sack
      ~WAND15~   // Rod of the Apprenti
      //~WAND15~   // Rod of the Apprenti (2nd)
      //~WAND15~   // Rod of the Apprenti (3rd)
    BEGIN
      PATCH_IF (FILE_EXISTS_IN_GAME ~%item%.itm~) BEGIN
        GET_OFFSET_ARRAY container_array ARE_V10_CONTAINERS
        PHP_EACH ~container_array~ AS ~int~ => ~container_offset~ BEGIN
          GET_OFFSET_ARRAY2 itm_array container_offset ARE_V10_ITEMS
          PHP_EACH ~itm_array~ AS ~int~ => ~itm_offset~ BEGIN
            READ_ASCII (itm_offset + 0x0) resref
            PATCH_IF (~%resref%~ STRING_EQUAL_CASE ~%item%~) BEGIN
              READ_ASCII (container_offset + 0x0) container_name (32) NULL
              READ_SHORT (itm_offset + 0xa) charges_1
              PATCH_IF (charges_1 > 1) BEGIN
                PATCH_IF (charges_1 < 1) BEGIN
                  PATCH_PRINT "~%SOURCE_FILE%~: ~%container_name%~, ~%item%.itm~, primary charges: %charges_1% => setting them to 1..."
                  WRITE_SHORT (itm_offset + 0xa) 1
				END
              END
            END
          END
        END
      END
    END
    PATCH_FOR_EACH ~item~ IN // 3 charges
      ~BOOT12~   // Gargoyle Boots
      //~HALB06~   // Blackmist +4 (2nd)
      //~HALB11~   // Ravager +5 (2nd)
      ~HELM31~   // Horned Helm of the Rock
      ~MISC3H~   // Horn of Blasting
      ~MISC3L~   // Horn of Silence
      ~MISC3M~   // Harp of Discord
      ~MISC3N~   // Azlaer's Harp
      ~MISC3O~   // Methild's Harp
      ~MISC3P~   // Glasses of Identification
      ~RING05~   // Ring of Invisibility
      ~RING33~   // Ring of the Ram
      ~RING39~   // Ring of Kangaxx
      //~SW1H51~   // Celestial Fury (2nd)
      ~WAND12~   // Rod of Wonder
      ~REGISAMU~ // Ruby Pendant of Beguiling
      ~WA2HARP~  // Harp of Pandemonium
    BEGIN
      PATCH_IF (FILE_EXISTS_IN_GAME ~%item%.itm~) BEGIN
        GET_OFFSET_ARRAY container_array ARE_V10_CONTAINERS
        PHP_EACH ~container_array~ AS ~int~ => ~container_offset~ BEGIN
          GET_OFFSET_ARRAY2 itm_array container_offset ARE_V10_ITEMS
          PHP_EACH ~itm_array~ AS ~int~ => ~itm_offset~ BEGIN
            READ_ASCII (itm_offset + 0x0) resref
            PATCH_IF (~%resref%~ STRING_EQUAL_CASE ~%item%~) BEGIN
              READ_ASCII (container_offset + 0x0) container_name (32) NULL
              READ_SHORT (itm_offset + 0xa) charges_1
              PATCH_IF (charges_1 > 3) BEGIN
                PATCH_IF (charges_1 < 3) BEGIN
                  PATCH_PRINT "~%SOURCE_FILE%~: ~%container_name%~, ~%item%.itm~, primary charges: %charges_1% => setting them to 3..."
                  WRITE_SHORT (itm_offset + 0xa) 3
				END
              END
            END
          END
        END
      END
    END
  END
BUT_ONLY


// Fixes for other mods
ACTION_IF (FILE_EXISTS_IN_GAME ~X#RINGRO.itm~) THEN BEGIN // BG1 NPC Project Ring of Human Influence fix
  ACTION_IF (FILE_EXISTS_IN_GAME ~ring30.itm~) THEN BEGIN
    COPY_EXISTING ~ring30.itm~ ~override/X#RINGRO.itm~
  END
END